var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};(()=>{function t(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{};var n={},o={},i=r.parcelRequire17b7;null==i&&((i=function(e){if(e in n)return n[e].exports;if(e in o){var t=o[e];delete o[e];var r={id:e,exports:{}};return n[e]=r,t.call(r.exports,r,r.exports),r.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){o[e]=t},r.parcelRequire17b7=i),i.register("8s8WA",(function(e,t){e.exports=function(e){function t(e){let n,o,i,s=null;function a(...e){if(!a.enabled)return;const r=a,o=Number(new Date),i=o-(n||o);r.diff=i,r.prev=n,r.curr=o,n=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";s++;const i=t.formatters[o];if("function"==typeof i){const t=e[s];n=i.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(o!==t.namespaces&&(o=t.namespaces,i=t.enabled(e)),i),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,r){const n=t(this.namespace+(void 0===r?":":r)+e);return n.log=this.log,n}function n(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(n),...t.skips.map(n).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let r;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(r=0;r<o;r++)n[r]&&("-"===(e=n[r].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let r,n;for(r=0,n=t.skips.length;r<n;r++)if(t.skips[r].test(e))return!1;for(r=0,n=t.names.length;r<n;r++)if(t.names[r].test(e))return!0;return!1},t.humanize=i("4N8Pa"),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((r=>{t[r]=e[r]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let r=0;for(let t=0;t<e.length;t++)r=(r<<5)-r+e.charCodeAt(t),r|=0;return t.colors[Math.abs(r)%t.colors.length]},t.enable(t.load()),t}})),i.register("4N8Pa",(function(e,t){var r=1e3,n=6e4,o=36e5,i=864e5;function s(e,t,r,n){var o=t>=1.5*r;return Math.round(e/r)+" "+n+(o?"s":"")}e.exports=function(e,t){t=t||{};var a,u,c=typeof e;if("string"===c&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var s=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*o;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===c&&isFinite(e))return t.long?(a=e,(u=Math.abs(a))>=i?s(a,u,i,"day"):u>=o?s(a,u,o,"hour"):u>=n?s(a,u,n,"minute"):u>=r?s(a,u,r,"second"):a+" ms"):function(e){var t=Math.abs(e);return t>=i?Math.round(e/i)+"d":t>=o?Math.round(e/o)+"h":t>=n?Math.round(e/n)+"m":t>=r?Math.round(e/r)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}})),i.register("16s93",(function(e,t){var r,n="undefined"!=typeof self?self:this,o=function(){function e(){this.fetch=!1,this.DOMException=n.DOMException}return e.prototype=n,new e}();r=o,function(e){var t="URLSearchParams"in r,n="Symbol"in r&&"iterator"in Symbol,o="FileReader"in r&&"Blob"in r&&function(){try{return new Blob,!0}catch(e){return!1}}(),i="FormData"in r,s="ArrayBuffer"in r;if(s)var a=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],u=ArrayBuffer.isView||function(e){return e&&a.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function l(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return n&&(t[Symbol.iterator]=function(){return t}),t}function h(e){this.map={},e instanceof h?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function d(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function y(e){var t=new FileReader,r=d(t);return t.readAsArrayBuffer(e),r}function g(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var r;this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:o&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:i&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:t&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():s&&o&&(r=e)&&DataView.prototype.isPrototypeOf(r)?(this._bodyArrayBuffer=g(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):s&&(ArrayBuffer.prototype.isPrototypeOf(e)||u(e))?this._bodyArrayBuffer=g(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},o&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(y)}),this.text=function(){var e,t,r,n=p(this);if(n)return n;if(this._bodyBlob)return e=this._bodyBlob,r=d(t=new FileReader),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},i&&(this.formData=function(){return this.text().then(v)}),this.json=function(){return this.text().then(JSON.parse)},this}h.prototype.append=function(e,t){e=c(e),t=f(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},h.prototype.delete=function(e){delete this.map[c(e)]},h.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},h.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},h.prototype.set=function(e,t){this.map[c(e)]=f(t)},h.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},h.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),l(e)},h.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),l(e)},h.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),l(e)},n&&(h.prototype[Symbol.iterator]=h.prototype.entries);var m=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(e,t){var r,n,o=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new h(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,o||null==e._bodyInit||(o=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new h(t.headers)),this.method=(n=(r=t.method||this.method||"GET").toUpperCase(),m.indexOf(n)>-1?n:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&o)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(o)}function v(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),o=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(o))}})),t}function A(e,t){t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new h(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(A.prototype),A.prototype.clone=function(){return new A(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new h(this.headers),url:this.url})},A.error=function(){var e=new A(null,{status:0,statusText:""});return e.type="error",e};var E=[301,302,303,307,308];A.redirect=function(e,t){if(-1===E.indexOf(t))throw new RangeError("Invalid status code");return new A(null,{status:t,headers:{location:e}})},e.DOMException=r.DOMException;try{new e.DOMException}catch(t){e.DOMException=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack},e.DOMException.prototype=Object.create(Error.prototype),e.DOMException.prototype.constructor=e.DOMException}function C(t,r){return new Promise((function(n,i){var s=new w(t,r);if(s.signal&&s.signal.aborted)return i(new e.DOMException("Aborted","AbortError"));var a=new XMLHttpRequest;function u(){a.abort()}a.onload=function(){var e,t,r={status:a.status,statusText:a.statusText,headers:(e=a.getAllResponseHeaders()||"",t=new h,e.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(e){var r=e.split(":"),n=r.shift().trim();if(n){var o=r.join(":").trim();t.append(n,o)}})),t)};r.url="responseURL"in a?a.responseURL:r.headers.get("X-Request-URL");var o="response"in a?a.response:a.responseText;n(new A(o,r))},a.onerror=function(){i(new TypeError("Network request failed"))},a.ontimeout=function(){i(new TypeError("Network request failed"))},a.onabort=function(){i(new e.DOMException("Aborted","AbortError"))},a.open(s.method,s.url,!0),"include"===s.credentials?a.withCredentials=!0:"omit"===s.credentials&&(a.withCredentials=!1),"responseType"in a&&o&&(a.responseType="blob"),s.headers.forEach((function(e,t){a.setRequestHeader(t,e)})),s.signal&&(s.signal.addEventListener("abort",u),a.onreadystatechange=function(){4===a.readyState&&s.signal.removeEventListener("abort",u)}),a.send(void 0===s._bodyInit?null:s._bodyInit)}))}C.polyfill=!0,r.fetch||(r.fetch=C,r.Headers=h,r.Request=w,r.Response=A),e.Headers=h,e.Request=w,e.Response=A,e.fetch=C,Object.defineProperty(e,"__esModule",{value:!0})}({}),o.fetch.ponyfill=!0,delete o.fetch.polyfill;var i=o;(t=i.fetch).default=i.fetch,t.fetch=i.fetch,t.Headers=i.Headers,t.Request=i.Request,t.Response=i.Response,e.exports=t})),i.register("e8CjI",(function(e,r){t(e.exports,"default",(()=>n)),i("8Tbzp");var n=window.crypto})),i.register("8Tbzp",(function(e,r){var n;n=e.exports,Object.defineProperty(n,"__esModule",{value:!0,configurable:!0}),t(e.exports,"default",(()=>o),(e=>o=e)),
/**
 * @file Web Cryptography API shim
 * @author Artem S Vybornov <vybornov@gmail.com>
 * @license MIT
 */
function(t,r){"function"==typeof define&&define.amd?define([],(function(){return r(t)})):e.exports?e.exports=r(t):r(t)}("undefined"!=typeof self?self:void 0,(function(e){if("function"!=typeof Promise)throw"Promise support required";var t=e.crypto||e.msCrypto;if(t){var r=t.subtle||t.webkitSubtle;if(r){var n=e.Crypto||t.constructor||Object,o=e.SubtleCrypto||r.constructor||Object,i=(e.CryptoKey||e.Key,e.navigator.userAgent.indexOf("Edge/")>-1),s=!!e.msCrypto&&!i,a=!t.subtle&&!!t.webkitSubtle;if(s||a){var u={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},c={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach((function(e){var n=r[e];r[e]=function(o,i,u){var c,f,l,d,v=[].slice.call(arguments);switch(e){case"generateKey":c=y(o),f=i,l=u;break;case"importKey":c=y(u),f=v[3],l=v[4],"jwk"===o&&((i=b(i)).alg||(i.alg=g(c)),i.key_ops||(i.key_ops="oct"!==i.kty?"d"in i?l.filter(O):l.filter(S):l.slice()),v[1]=m(i));break;case"unwrapKey":c=v[4],f=v[5],l=v[6],v[2]=u._key}if("generateKey"===e&&"HMAC"===c.name&&c.hash)return c.length=c.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[c.hash.name],r.importKey("raw",t.getRandomValues(new Uint8Array(c.length+7>>3)),c,f,l);if(a&&"generateKey"===e&&"RSASSA-PKCS1-v1_5"===c.name&&(!c.modulusLength||c.modulusLength>=2048))return(o=y(o)).name="RSAES-PKCS1-v1_5",delete o.hash,r.generateKey(o,!0,["encrypt","decrypt"]).then((function(e){return Promise.all([r.exportKey("jwk",e.publicKey),r.exportKey("jwk",e.privateKey)])})).then((function(e){return e[0].alg=e[1].alg=g(c),e[0].key_ops=l.filter(S),e[1].key_ops=l.filter(O),Promise.all([r.importKey("jwk",e[0],c,!0,e[0].key_ops),r.importKey("jwk",e[1],c,f,e[1].key_ops)])})).then((function(e){return{publicKey:e[0],privateKey:e[1]}}));if((a||s&&"SHA-1"===(c.hash||{}).name)&&"importKey"===e&&"jwk"===o&&"HMAC"===c.name&&"oct"===i.kty)return r.importKey("raw",p(h(i.k)),u,v[3],v[4]);if(a&&"importKey"===e&&("spki"===o||"pkcs8"===o))return r.importKey("jwk",w(i),u,v[3],v[4]);if(s&&"unwrapKey"===e)return r.decrypt(v[3],u,i).then((function(e){return r.importKey(o,e,v[4],v[5],v[6])}));try{d=n.apply(r,v)}catch(e){return Promise.reject(e)}return s&&(d=new Promise((function(e,t){d.onabort=d.onerror=function(e){t(e)},d.oncomplete=function(t){e(t.target.result)}}))),d=d.then((function(e){return"HMAC"===c.name&&(c.length||(c.length=8*e.algorithm.length)),0==c.name.search("RSA")&&(c.modulusLength||(c.modulusLength=(e.publicKey||e).algorithm.modulusLength),c.publicExponent||(c.publicExponent=(e.publicKey||e).algorithm.publicExponent)),e.publicKey&&e.privateKey?{publicKey:new C(e.publicKey,c,f,l.filter(S)),privateKey:new C(e.privateKey,c,f,l.filter(O))}:new C(e,c,f,l)}))}})),["exportKey","wrapKey"].forEach((function(e){var t=r[e];r[e]=function(n,o,i){var u,c=[].slice.call(arguments);switch(e){case"exportKey":c[1]=o._key;break;case"wrapKey":c[1]=o._key,c[2]=i._key}if((a||s&&"SHA-1"===(o.algorithm.hash||{}).name)&&"exportKey"===e&&"jwk"===n&&"HMAC"===o.algorithm.name&&(c[0]="raw"),!a||"exportKey"!==e||"spki"!==n&&"pkcs8"!==n||(c[0]="jwk"),s&&"wrapKey"===e)return r.exportKey(n,o).then((function(e){return"jwk"===n&&(e=p(unescape(encodeURIComponent(JSON.stringify(b(e)))))),r.encrypt(c[3],i,e)}));try{u=t.apply(r,c)}catch(e){return Promise.reject(e)}return s&&(u=new Promise((function(e,t){u.onabort=u.onerror=function(e){t(e)},u.oncomplete=function(t){e(t.target.result)}}))),"exportKey"===e&&"jwk"===n&&(u=u.then((function(e){return(a||s&&"SHA-1"===(o.algorithm.hash||{}).name)&&"HMAC"===o.algorithm.name?{kty:"oct",alg:g(o.algorithm),key_ops:o.usages.slice(),ext:!0,k:l(d(e))}:((e=b(e)).alg||(e.alg=g(o.algorithm)),e.key_ops||(e.key_ops="public"===o.type?o.usages.filter(S):"private"===o.type?o.usages.filter(O):o.usages.slice()),e)}))),!a||"exportKey"!==e||"spki"!==n&&"pkcs8"!==n||(u=u.then((function(e){return v(b(e))}))),u}})),["encrypt","decrypt","sign","verify"].forEach((function(e){var t=r[e];r[e]=function(n,o,i,a){if(s&&(!i.byteLength||a&&!a.byteLength))throw new Error("Empy input is not allowed");var u,c=[].slice.call(arguments),f=y(n);if(s&&"decrypt"===e&&"AES-GCM"===f.name){var l=n.tagLength>>3;c[2]=(i.buffer||i).slice(0,i.byteLength-l),n.tag=(i.buffer||i).slice(i.byteLength-l)}c[1]=o._key;try{u=t.apply(r,c)}catch(e){return Promise.reject(e)}return s&&(u=new Promise((function(t,r){u.onabort=u.onerror=function(e){r(e)},u.oncomplete=function(r){if(r=r.target.result,"encrypt"===e&&r instanceof AesGcmEncryptResult){var n=r.ciphertext,o=r.tag;(r=new Uint8Array(n.byteLength+o.byteLength)).set(new Uint8Array(n),0),r.set(new Uint8Array(o),n.byteLength),r=r.buffer}t(r)}}))),u}})),s){var f=r.digest;r.digest=function(e,t){if(!t.byteLength)throw new Error("Empy input is not allowed");var n;try{n=f.call(r,e,t)}catch(e){return Promise.reject(e)}return n=new Promise((function(e,t){n.onabort=n.onerror=function(e){t(e)},n.oncomplete=function(t){e(t.target.result)}}))},e.crypto=Object.create(t,{getRandomValues:{value:function(e){return t.getRandomValues(e)}},subtle:{value:r}}),e.CryptoKey=C}a&&(t.subtle=r,e.Crypto=n,e.SubtleCrypto=o,e.CryptoKey=C)}}}function l(e){return btoa(e).replace(/\=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function h(e){return e=(e+="===").slice(0,-e.length%4),atob(e.replace(/-/g,"+").replace(/_/g,"/"))}function p(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}function d(e){return e instanceof ArrayBuffer&&(e=new Uint8Array(e)),String.fromCharCode.apply(String,e)}function y(e){var t={name:(e.name||e||"").toUpperCase().replace("V","v")};switch(t.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":e.length&&(t.length=e.length);break;case"HMAC":e.hash&&(t.hash=y(e.hash)),e.length&&(t.length=e.length);break;case"RSAES-PKCS1-v1_5":e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":e.hash&&(t.hash=y(e.hash)),e.publicExponent&&(t.publicExponent=new Uint8Array(e.publicExponent)),e.modulusLength&&(t.modulusLength=e.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return t}function g(e){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[e.name][(e.hash||{}).name||e.length||""]}function b(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&(e=JSON.parse(decodeURIComponent(escape(d(e)))));var t={kty:e.kty,alg:e.alg,ext:e.ext||e.extractable};switch(t.kty){case"oct":t.k=e.k;case"RSA":["n","e","d","p","q","dp","dq","qi","oth"].forEach((function(r){r in e&&(t[r]=e[r])}));break;default:throw new TypeError("Unsupported key type")}return t}function m(e){var t=b(e);return s&&(t.extractable=t.ext,delete t.ext),p(unescape(encodeURIComponent(JSON.stringify(t)))).buffer}function w(e){var t=A(e),r=!1;t.length>2&&(r=!0,t.shift());var n={ext:!0};if("1.2.840.113549.1.1.1"!==t[0][0])throw new TypeError("Unsupported key type");var o=["n","e","d","p","q","dp","dq","qi"],i=A(t[1]);r&&i.shift();for(var s=0;s<i.length;s++)i[s][0]||(i[s]=i[s].subarray(1)),n[o[s]]=l(d(i[s]));return n.kty="RSA",n}function v(e){var t,r=[["",null]],n=!1;if("RSA"!==e.kty)throw new TypeError("Unsupported key type");for(var o=["n","e","d","p","q","dp","dq","qi"],i=[],s=0;s<o.length&&o[s]in e;s++){var a=i[s]=p(h(e[o[s]]));128&a[0]&&(i[s]=new Uint8Array(a.length+1),i[s].set(a,1))}return i.length>2&&(n=!0,i.unshift(new Uint8Array([0]))),r[0][0]="1.2.840.113549.1.1.1",t=i,r.push(new Uint8Array(E(t)).buffer),n?r.unshift(new Uint8Array([0])):r[1]={tag:3,value:r[1]},new Uint8Array(E(r)).buffer}function A(e,t){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),t||(t={pos:0,end:e.length}),t.end-t.pos<2||t.end>e.length)throw new RangeError("Malformed DER");var r,n=e[t.pos++],o=e[t.pos++];if(o>=128){if(o&=127,t.end-t.pos<o)throw new RangeError("Malformed DER");for(var i=0;o--;)i<<=8,i|=e[t.pos++];o=i}if(t.end-t.pos<o)throw new RangeError("Malformed DER");switch(n){case 2:r=e.subarray(t.pos,t.pos+=o);break;case 3:if(e[t.pos++])throw new Error("Unsupported bit string");o--;case 4:r=new Uint8Array(e.subarray(t.pos,t.pos+=o)).buffer;break;case 5:r=null;break;case 6:var s=btoa(d(e.subarray(t.pos,t.pos+=o)));if(!(s in u))throw new Error("Unsupported OBJECT ID "+s);r=u[s];break;case 48:r=[];for(var a=t.pos+o;t.pos<a;)r.push(A(e,t));break;default:throw new Error("Unsupported DER tag 0x"+n.toString(16))}return r}function E(e,t){t||(t=[]);var r=0,n=0,o=t.length+2;if(t.push(0,0),e instanceof Uint8Array){r=2,n=e.length;for(var i=0;i<n;i++)t.push(e[i])}else if(e instanceof ArrayBuffer)for(r=4,n=e.byteLength,e=new Uint8Array(e),i=0;i<n;i++)t.push(e[i]);else if(null===e)r=5,n=0;else if("string"==typeof e&&e in c){var s=p(atob(c[e]));for(r=6,n=s.length,i=0;i<n;i++)t.push(s[i])}else if(e instanceof Array){for(i=0;i<e.length;i++)E(e[i],t);r=48,n=t.length-o}else{if(!("object"==typeof e&&3===e.tag&&e.value instanceof ArrayBuffer))throw new Error("Unsupported DER value "+e);for(r=3,n=(e=new Uint8Array(e.value)).byteLength,t.push(0),i=0;i<n;i++)t.push(e[i]);n++}if(n>=128){var a=n;for(n=4,t.splice(o,0,a>>24&255,a>>16&255,a>>8&255,255&a);n>1&&!(a>>24);)a<<=8,n--;n<4&&t.splice(o,4-n),n|=128}return t.splice(o-2,2,r,n),t}function C(e,t,r,n){Object.defineProperties(this,{_key:{value:e},type:{value:e.type,enumerable:!0},extractable:{value:void 0===r?e.extractable:r,enumerable:!0},algorithm:{value:void 0===t?e.algorithm:t,enumerable:!0},usages:{value:void 0===n?e.usages:n,enumerable:!0}})}function S(e){return"verify"===e||"encrypt"===e||"wrapKey"===e}function O(e){return"sign"===e||"decrypt"===e||"unwrapKey"===e}}));var o={}})),i.register("jk3TS",(function(e,t){var n;n=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function i(e,t){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},i(e,t)}function s(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return s(e)}function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=o(e);if(t){var i=o(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return a(this,r)}}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=o(e)););return e}function f(){return f="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=c(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(arguments.length<3?e:r):o.value}},f.apply(this,arguments)}var l,h=function(){function t(){e(this,t),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return n(t,[{key:"addEventListener",value:function(e,t,r){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push({callback:t,options:r})}},{key:"removeEventListener",value:function(e,t){if(e in this.listeners)for(var r=this.listeners[e],n=0,o=r.length;n<o;n++)if(r[n].callback===t)return void r.splice(n,1)}},{key:"dispatchEvent",value:function(e){if(e.type in this.listeners){for(var t=this.listeners[e.type].slice(),r=0,n=t.length;r<n;r++){var o=t[r];try{o.callback.call(this,e)}catch(e){Promise.resolve().then((function(){throw e}))}o.options&&o.options.once&&this.removeEventListener(e.type,o.callback)}return!e.defaultPrevented}}}]),t}(),p=function(t){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}(a,t);var r=u(a);function a(){var t;return e(this,a),(t=r.call(this)).listeners||h.call(s(t)),Object.defineProperty(s(t),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(s(t),"onabort",{value:null,writable:!0,configurable:!0}),Object.defineProperty(s(t),"reason",{value:void 0,writable:!0,configurable:!0}),t}return n(a,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(e){"abort"===e.type&&(this.aborted=!0,"function"==typeof this.onabort&&this.onabort.call(this,e)),f(o(a.prototype),"dispatchEvent",this).call(this,e)}}]),a}(h),d=function(){function t(){e(this,t),Object.defineProperty(this,"signal",{value:new p,writable:!0,configurable:!0})}return n(t,[{key:"abort",value:function(e){var t;try{t=new Event("abort")}catch(e){"undefined"!=typeof document?document.createEvent?(t=document.createEvent("Event")).initEvent("abort",!1,!1):(t=document.createEventObject()).type="abort":t={type:"abort",bubbles:!1,cancelable:!1}}var r=e;if(void 0===r)if("undefined"==typeof document)(r=new Error("This operation was aborted")).name="AbortError";else try{r=new DOMException("signal is aborted without reason")}catch(e){(r=new Error("This operation was aborted")).name="AbortError"}this.signal.reason=r,this.signal.dispatchEvent(t)}},{key:"toString",value:function(){return"[object AbortController]"}}]),t}();"undefined"!=typeof Symbol&&Symbol.toStringTag&&(d.prototype[Symbol.toStringTag]="AbortController",p.prototype[Symbol.toStringTag]="AbortSignal"),function(e){return e.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL?(console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill"),!0):"function"==typeof e.Request&&!e.Request.prototype.hasOwnProperty("signal")||!e.AbortController}(l="undefined"!=typeof self?self:r)&&(l.AbortController=d,l.AbortSignal=p)},"function"==typeof define&&define.amd?define(n):n()}));var s={};Object.defineProperty(s,"__esModule",{value:!0});var a={};Object.defineProperty(a,"__esModule",{value:!0}),a.init=a.buildTokenRequest=a.ready=a.onMessage=a.isInPopUp=a.isInFrame=a.authorize=a.getSecurityExtensions=a.fetchWellKnownJson=a.KEY=void 0;var u={};Object.defineProperty(u,"__esModule",{value:!0}),u.assertJsonPatch=u.assert=u.getTargetWindow=u.getPatientParam=u.byCodes=u.byCode=u.getAccessTokenExpiration=u.getTimeInFuture=u.jwtDecode=u.randomString=u.absolute=u.makeArray=u.setPath=u.getPath=u.fetchConformanceStatement=u.getAndCache=u.request=u.loweCaseKeys=u.responseToJSON=u.checkResponse=u.units=u.debug=void 0;var c={};Object.defineProperty(c,"__esModule",{value:!0});class f extends Error{constructor(e){super(`${e.status} ${e.statusText}\nURL: ${e.url}`),this.name="HttpError",this.response=e,this.statusCode=e.status,this.status=e.status,this.statusText=e.statusText}async parse(){if(!this.response.bodyUsed)try{const e=this.response.headers.get("content-type")||"text/plain";if(e.match(/\bjson\b/i)){let e=await this.response.json();e.error?(this.message+="\n"+e.error,e.error_description&&(this.message+=": "+e.error_description)):this.message+="\n\n"+JSON.stringify(e,null,4)}else if(e.match(/^text\//i)){let e=await this.response.text();e&&(this.message+="\n\n"+e)}}catch(e){}return this}toJSON(){return{name:this.name,statusCode:this.statusCode,status:this.status,statusText:this.statusText,message:this.message}}}c.default=f;var l={};Object.defineProperty(l,"__esModule",{value:!0}),l.SMART_KEY=l.patientParams=l.fhirVersions=l.patientCompartment=void 0,l.patientCompartment=["Account","AdverseEvent","AllergyIntolerance","Appointment","AppointmentResponse","AuditEvent","Basic","BodySite","BodyStructure","CarePlan","CareTeam","ChargeItem","Claim","ClaimResponse","ClinicalImpression","Communication","CommunicationRequest","Composition","Condition","Consent","Coverage","CoverageEligibilityRequest","CoverageEligibilityResponse","DetectedIssue","DeviceRequest","DeviceUseRequest","DeviceUseStatement","DiagnosticOrder","DiagnosticReport","DocumentManifest","DocumentReference","EligibilityRequest","Encounter","EnrollmentRequest","EpisodeOfCare","ExplanationOfBenefit","FamilyMemberHistory","Flag","Goal","Group","ImagingManifest","ImagingObjectSelection","ImagingStudy","Immunization","ImmunizationEvaluation","ImmunizationRecommendation","Invoice","List","MeasureReport","Media","MedicationAdministration","MedicationDispense","MedicationOrder","MedicationRequest","MedicationStatement","MolecularSequence","NutritionOrder","Observation","Order","Patient","Person","Procedure","ProcedureRequest","Provenance","QuestionnaireResponse","ReferralRequest","RelatedPerson","RequestGroup","ResearchSubject","RiskAssessment","Schedule","ServiceRequest","Specimen","SupplyDelivery","SupplyRequest","VisionPrescription"],l.fhirVersions={"0.4.0":2,"0.5.0":2,"1.0.0":2,"1.0.1":2,"1.0.2":2,"1.1.0":3,"1.4.0":3,"1.6.0":3,"1.8.0":3,"3.0.0":3,"3.0.1":3,"3.3.0":4,"3.5.0":4,"4.0.0":4,"4.0.1":4},l.patientParams=["patient","subject","requester","member","actor","beneficiary"],l.SMART_KEY="SMART_KEY";var h,p,d,y={},g=h={};function b(){throw new Error("setTimeout has not been defined")}function m(){throw new Error("clearTimeout has not been defined")}function w(e){if(p===setTimeout)return setTimeout(e,0);if((p===b||!p)&&setTimeout)return p=setTimeout,setTimeout(e,0);try{return p(e,0)}catch(t){try{return p.call(null,e,0)}catch(t){return p.call(this,e,0)}}}!function(){try{p="function"==typeof setTimeout?setTimeout:b}catch(e){p=b}try{d="function"==typeof clearTimeout?clearTimeout:m}catch(e){d=m}}();var v,A=[],E=!1,C=-1;function S(){E&&v&&(E=!1,v.length?A=v.concat(A):C=-1,A.length&&O())}function O(){if(!E){var e=w(S);E=!0;for(var t=A.length;t;){for(v=A,A=[];++C<t;)v&&v[C].run();C=-1,t=A.length}v=null,E=!1,function(e){if(d===clearTimeout)return clearTimeout(e);if((d===m||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}(e)}}function k(e,t){this.fun=e,this.array=t}function _(){}g.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];A.push(new k(e,t)),1!==A.length||E||w(O)},k.prototype.run=function(){this.fun.apply(null,this.array)},g.title="browser",g.browser=!0,g.env={},g.argv=[],g.version="",g.versions={},g.on=_,g.addListener=_,g.once=_,g.off=_,g.removeListener=_,g.removeAllListeners=_,g.emit=_,g.prependListener=_,g.prependOnceListener=_,g.listeners=function(e){return[]},g.binding=function(e){throw new Error("process.binding is not supported")},g.cwd=function(){return"/"},g.chdir=function(e){throw new Error("process.chdir is not supported")},g.umask=function(){return 0},y.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+y.humanize(this.diff),!this.useColors)return;const t="color: "+this.color;e.splice(1,0,t,"color: inherit");let r=0,n=0;e[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(n=r))})),e.splice(n,0,t)},y.save=function(e){try{e?y.storage.setItem("debug",e):y.storage.removeItem("debug")}catch(e){}},y.load=function(){let e;try{e=y.storage.getItem("debug")}catch(e){}return!e&&void 0!==h&&"env"in h&&(e=void 0),e},y.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},y.storage=function(){try{return localStorage}catch(e){}}(),y.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),y.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],y.log=console.debug||console.log||(()=>{}),y=i("8s8WA")(y);const{formatters:P}=y;P.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};const{fetch:R}="undefined"!=typeof FHIRCLIENT_PURE?window:i("16s93"),T=y("FHIR");u.debug=T;const U={};function j({value:e,code:t}){if("number"!=typeof e)throw new Error("Found a non-numerical unit: "+e+" "+t)}async function x(e){if(!e.ok){const t=new c.default(e);throw await t.parse(),t}return e}function I(e){return e.text().then((e=>e.length?JSON.parse(e):""))}function F(e){if(!e)return e;if(Array.isArray(e))return e.map((e=>e&&"object"==typeof e?F(e):e));let t={};return Object.keys(e).forEach((r=>{const n=r.toLowerCase(),o=e[r];t[n]=o&&"object"==typeof o?F(o):o})),t}function B(e,t={}){const{includeResponse:r}=t,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(t,["includeResponse"]);return R(e,Object.assign(Object.assign({mode:"cors"},n),{headers:Object.assign({accept:"application/json"},F(n.headers))})).then(x).then((e=>{const t=e.headers.get("content-type")+"";return t.match(/\bjson\b/i)?I(e).then((t=>({res:e,body:t}))):t.match(/^text\//i)?e.text().then((t=>({res:e,body:t}))):{res:e}})).then((({res:e,body:t})=>{if(!t&&201==e.status){const t=e.headers.get("location");if(t)return B(t,Object.assign(Object.assign({},n),{method:"GET",body:null,includeResponse:r}))}return r?{body:t,response:e}:void 0===t?e:t}))}function M(e,t,r=!1){return r||!U[e]?(U[e]=B(e,t),U[e]):Promise.resolve(U[e])}function L(e,t=""){if(!(t=t.trim()))return e;let r=t.split("."),n=e;for(;n&&r.length;){const e=r.shift();if(!e&&Array.isArray(n))return n.map((e=>L(e,r.join("."))));n=n[e]}return n}function K(e){return Array.isArray(e)?e:[e]}function D(e,t){const r=e.split(".")[1];return r?JSON.parse(t.atob(r)):null}function q(e,t){const r={};function n(e,t){e&&Array.isArray(e.coding)&&e.coding.forEach((({code:e})=>{e&&(r[e]=r[e]||[],r[e].push(t))}))}return K(e).forEach((e=>{"Observation"===e.resourceType&&e[t]&&(Array.isArray(e[t])?e[t].forEach((t=>n(t,e))):n(e[t],e))})),r}function N(e,t){if(!e)throw new Error(t)}u.units={cm({code:e,value:t}){if(j({code:e,value:t}),"cm"==e)return t;if("m"==e)return 100*t;if("in"==e)return 2.54*t;if("[in_us]"==e)return 2.54*t;if("[in_i]"==e)return 2.54*t;if("ft"==e)return 30.48*t;if("[ft_us]"==e)return 30.48*t;throw new Error("Unrecognized length unit: "+e)},kg({code:e,value:t}){if(j({code:e,value:t}),"kg"==e)return t;if("g"==e)return t/1e3;if(e.match(/lb/))return t/2.20462;if(e.match(/oz/))return t/35.274;throw new Error("Unrecognized weight unit: "+e)},any:e=>(j(e),e.value)},u.checkResponse=x,u.responseToJSON=I,u.loweCaseKeys=F,u.request=B,u.getAndCache=M,u.fetchConformanceStatement=function(e="/",t){const r=String(e).replace(/\/*$/,"/")+"metadata";return M(r,t).catch((e=>{throw new Error(`Failed to fetch the conformance statement from "${r}". ${e}`)}))},u.getPath=L,u.setPath=function(e,t,r,n=!1){return t.trim().split(".").reduce(((e,t,o,i)=>{if(!e||o!==i.length-1)return e&&void 0===e[t]&&n&&(e[t]=i[o+1].match(/^[0-9]+$/)?[]:{}),e?e[t]:void 0;e[t]=r}),e),e},u.makeArray=K,u.absolute=function(e,t){return e.match(/^http/)||e.match(/^urn/)?e:String(t||"").replace(/\/+$/,"")+"/"+e.replace(/^\/+/,"")},u.randomString=function(e=8,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"){const r=[],n=t.length;for(;e--;)r.push(t.charAt(Math.floor(Math.random()*n)));return r.join("")},u.jwtDecode=D,u.getTimeInFuture=function(e=120,t){return Math.floor(+(t||new Date)/1e3+e)},u.getAccessTokenExpiration=function(e,t){const r=Math.floor(Date.now()/1e3);if(e.expires_in)return r+e.expires_in;if(e.access_token){let r=D(e.access_token,t);if(r&&r.exp)return r.exp}return r+300},u.byCode=q,u.byCodes=function(e,t){const r=q(e,t);return(...e)=>e.filter((e=>e+""in r)).reduce(((e,t)=>e.concat(r[t+""])),[])},u.getPatientParam=function(e,t){const r=(L(e,"rest.0.resource")||[]).find((e=>e.type===t));if(!r)throw new Error(`Resource "${t}" is not supported by this FHIR server`);if(!Array.isArray(r.searchParam))throw new Error(`No search parameters supported for "${t}" on this FHIR server`);if("Patient"==t&&r.searchParam.find((e=>"_id"==e.name)))return"_id";const n=l.patientParams.find((e=>r.searchParam.find((t=>t.name==e))));if(!n)throw new Error("I don't know what param to use for "+t);return n},u.getTargetWindow=async function(e,t=800,r=720){if("function"==typeof e&&(e=await e()),e&&"object"==typeof e)return e;if("string"!=typeof e)return T("Invalid target type '%s'. Failing back to '_self'.",typeof e),self;if("_self"==e)return self;if("_parent"==e)return parent;if("_top"==e)return top||self;if("_blank"==e){let e,t=null;try{if(t=window.open("","SMARTAuthPopup"),!t)throw new Error("Perhaps window.open was blocked")}catch(t){e=t}return t||(T("Cannot open window. Failing back to '_self'. %s",e),self)}if("popup"==e){let e,n=null;try{if(n=window.open("","SMARTAuthPopup",["height="+r,"width="+t,"menubar=0","resizable=1","status=0","top="+(screen.height-r)/2,"left="+(screen.width-t)/2].join(",")),!n)throw new Error("Perhaps the popup window was blocked")}catch(t){e=t}return n||(T("Cannot open window. Failing back to '_self'. %s",e),self)}return frames[e]||(T("Unknown target '%s'. Failing back to '_self'.",e),self)},u.assert=N,u.assertJsonPatch=function(e){N(Array.isArray(e),"The JSON patch must be an array"),N(e.length>0,"The JSON patch array should not be empty"),e.forEach((e=>{N(["add","replace","test","move","copy","remove"].indexOf(e.op)>-1,'Each patch operation must have an "op" property which must be one of: "add", "replace", "test", "move", "copy", "remove"'),N(e.path&&typeof e.path,`Invalid "${e.op}" operation. Missing "path" property`),"add"==e.op||"replace"==e.op||"test"==e.op?(N("value"in e,`Invalid "${e.op}" operation. Missing "value" property`),N(3==Object.keys(e).length,`Invalid "${e.op}" operation. Contains unknown properties`)):"move"==e.op||"copy"==e.op?(N("string"==typeof e.from,`Invalid "${e.op}" operation. Requires a string "from" property`),N(3==Object.keys(e).length,`Invalid "${e.op}" operation. Contains unknown properties`)):N(2==Object.keys(e).length,`Invalid "${e.op}" operation. Contains unknown properties`)}))};var z={};Object.defineProperty(z,"__esModule",{value:!0});var H={};Object.defineProperty(H,"__esModule",{value:!0}),H.default={expired:"Session expired! Please re-launch the app",noScopeForId:"Trying to get the ID of the selected %s. Please add 'launch' or 'launch/%s' to the requested scopes and try again.",noIfNoAuth:"You are trying to get %s but the app is not authorized yet.",noFreeContext:"Please don't use open fhir servers if you need to access launch context items like the %S."};const{Response:$}="undefined"!=typeof FHIRCLIENT_PURE?window:i("16s93"),J=u.debug.extend("client");function W(e,t,r,n,o,i){const s=(0,u.getPath)(e,t);if(s){const a=Array.isArray(s);return Promise.all((0,u.makeArray)(s).filter(Boolean).map(((s,c)=>{const f=s.reference;if(f)return function(e,t,r,n){return t[e]||(t[e]=r.request({url:e,signal:n}).then((r=>(t[e]=r,r)),(r=>{throw delete t[e],r}))),Promise.resolve(t[e])}(f,n,o,i).then((n=>{r&&(a?t.indexOf("..")>-1?(0,u.setPath)(e,`${t.replace("..",`.${c}.`)}`,n):(0,u.setPath)(e,`${t}.${c}`,n):(0,u.setPath)(e,t,n))})).catch((e=>{if(404!==e.status)throw e}))})))}}function Y(e,t,r,n,o){let i=(0,u.makeArray)(t.resolveReferences).filter(Boolean).map((e=>String(e).trim())).filter(Boolean);if(i=i.filter(((e,t)=>!(i.indexOf(e,t+1)>-1&&(J('Duplicated reference path "%s"',e),1)))),!i.length)return Promise.resolve();const s={};i.forEach((e=>{const t=e.split(".").length;s[t]||(s[t]=[]),s[t].push(e)}));let a=Promise.resolve();return Object.keys(s).sort().forEach((i=>{const u=s[i];a=a.then((()=>Promise.all(u.map((i=>W(e,i,!!t.graph,r,n,o))))))})),a}z.default=class{constructor(e,t){this.units=u.units;const r="string"==typeof t?{serverUrl:t}:t;(0,u.assert)(r.serverUrl&&r.serverUrl.match(/https?:\/\/.+/),'A "serverUrl" option is required and must begin with "http(s)"'),this.state=r,this.environment=e,this._refreshTask=null;const n=this;this.patient={get id(){return n.getPatientId()},read:e=>{const t=this.patient.id;return t?this.request(Object.assign(Object.assign({},e),{url:`Patient/${t}`})):Promise.reject(new Error("Patient is not available"))},request:(e,t={})=>this.patient.id?(async()=>{const r=await async function(e,t){const r=(0,u.absolute)("/",t.state.serverUrl);async function n(e){const r=e.pathname.split("/").pop();(0,u.assert)(r,`Invalid url "${e}"`),(0,u.assert)(l.patientCompartment.indexOf(r)>-1,`Cannot filter "${r}" resources by patient`);const n=await(0,u.fetchConformanceStatement)(t.state.serverUrl),o=(0,u.getPatientParam)(n,r);return e.searchParams.set(o,t.patient.id),e.href}return"string"==typeof e||e instanceof URL?{url:await n(new URL(e+"",r))}:(e.url=await n(new URL(e.url+"",r)),e)}(e,this);return this.request(r,t)})():Promise.reject(new Error("Patient is not available"))},this.encounter={get id(){return n.getEncounterId()},read:e=>{const t=this.encounter.id;return t?this.request(Object.assign(Object.assign({},e),{url:`Encounter/${t}`})):Promise.reject(new Error("Encounter is not available"))}},this.user={get fhirUser(){return n.getFhirUser()},get id(){return n.getUserId()},get resourceType(){return n.getUserType()},read:e=>{const t=this.user.fhirUser;return t?this.request(Object.assign(Object.assign({},e),{url:t})):Promise.reject(new Error("User is not available"))}},this.connect(e.fhir)}connect(e){if("function"==typeof e){const t={baseUrl:this.state.serverUrl.replace(/\/$/,"")},r=this.getState("tokenResponse.access_token");if(r)t.auth={token:r};else{const{username:e,password:r}=this.state;e&&r&&(t.auth={user:e,pass:r})}this.api=e(t);const n=this.getState("tokenResponse.patient");n&&(this.patient.api=e(Object.assign(Object.assign({},t),{patient:n})))}return this}getPatientId(){const e=this.state.tokenResponse;return e?e.patient?e.patient:((this.state.scope||"").match(/\blaunch(\/patient)?\b/)?J("The ID of the selected patient is not available. Please check if your server supports that."):J(H.default.noScopeForId,"patient","patient"),null):(this.state.authorizeUri?J(H.default.noIfNoAuth,"the ID of the selected patient"):J(H.default.noFreeContext,"selected patient"),null)}getEncounterId(){const e=this.state.tokenResponse;return e?e.encounter?e.encounter:((this.state.scope||"").match(/\blaunch(\/encounter)?\b/)?J("The ID of the selected encounter is not available. Please check if your server supports that, and that the selected patient has any recorded encounters."):J(H.default.noScopeForId,"encounter","encounter"),null):(this.state.authorizeUri?J(H.default.noIfNoAuth,"the ID of the selected encounter"):J(H.default.noFreeContext,"selected encounter"),null)}getIdToken(){const e=this.state.tokenResponse;if(e){const t=e.id_token,r=this.state.scope||"";if(!t){const e=r.match(/\bopenid\b/),t=r.match(/\bprofile\b/),n=r.match(/\bfhirUser\b/);return J(e&&(n||t)?"The id_token is not available. Please check if your server supports that.":"You are trying to get the id_token but you are not using the right scopes. Please add 'openid' and 'fhirUser' or 'profile' to the scopes you are requesting."),null}return(0,u.jwtDecode)(t,this.environment)}return this.state.authorizeUri?J(H.default.noIfNoAuth,"the id_token"):J(H.default.noFreeContext,"id_token"),null}getFhirUser(){const e=this.getIdToken();return e?e.fhirUser?e.fhirUser.split("/").slice(-2).join("/"):e.profile:null}getUserId(){const e=this.getFhirUser();return e?e.split("/")[1]:null}getUserType(){const e=this.getFhirUser();return e?e.split("/")[0]:null}getAuthorizationHeader(){const e=this.getState("tokenResponse.access_token");if(e)return"Bearer "+e;const{username:t,password:r}=this.state;return t&&r?"Basic "+this.environment.btoa(t+":"+r):null}async _clearState(){const e=this.environment.getStorage(),t=await e.get(l.SMART_KEY);t&&await e.unset(t),await e.unset(l.SMART_KEY),this.state.tokenResponse={}}create(e,t){return this.request(Object.assign(Object.assign({},t),{url:`${e.resourceType}`,method:"POST",body:JSON.stringify(e),headers:Object.assign({"content-type":"application/json"},(t||{}).headers)}))}update(e,t){return this.request(Object.assign(Object.assign({},t),{url:`${e.resourceType}/${e.id}`,method:"PUT",body:JSON.stringify(e),headers:Object.assign({"content-type":"application/json"},(t||{}).headers)}))}delete(e,t={}){return this.request(Object.assign(Object.assign({},t),{url:e,method:"DELETE"}))}async patch(e,t,r={}){return(0,u.assertJsonPatch)(t),this.request(Object.assign(Object.assign({},r),{url:e,method:"PATCH",body:JSON.stringify(t),headers:Object.assign({prefer:"return=presentation","content-type":"application/json-patch+json; charset=UTF-8"},r.headers)}))}async request(e,t={},r={}){var n;const o=u.debug.extend("client:request");let i;(0,u.assert)(e,"request requires an url or request options as argument"),"string"==typeof e||e instanceof URL?(i=String(e),e={}):i=String(e.url),i=(0,u.absolute)(i,this.state.serverUrl);const s={graph:!1!==t.graph,flat:!!t.flat,pageLimit:null!==(n=t.pageLimit)&&void 0!==n?n:1,resolveReferences:t.resolveReferences||[],useRefreshToken:!1!==t.useRefreshToken,onPage:"function"==typeof t.onPage?t.onPage:void 0},a=e.signal||void 0;let c;return(s.useRefreshToken?this.refreshIfNeeded({signal:a}).then((()=>e)):Promise.resolve(e)).then((e=>{const t=this.getAuthorizationHeader();return t&&(e.headers=Object.assign(Object.assign({},e.headers),{authorization:t})),e})).then((e=>(o("%s, options: %O, fhirOptions: %O",i,e,s),(0,u.request)(i,e).then((t=>e.includeResponse?(c=t.response,t.body):t))))).catch((async e=>{if(401==e.status){if(!this.getState("tokenResponse.access_token"))throw e.message+="\nThis app cannot be accessed directly. Please launch it as SMART app!",e;if(!s.useRefreshToken)throw o("Your session has expired and the useRefreshToken option is set to false. Please re-launch the app."),await this._clearState(),e.message+="\n"+H.default.expired,e;throw o("Auto-refresh failed! Please re-launch the app."),await this._clearState(),e.message+="\n"+H.default.expired,e}throw e})).catch((e=>{throw 403==e.status&&o("Permission denied! Please make sure that you have requested the proper scopes."),e})).then((t=>t?"string"==typeof t||t instanceof $?t:(async e=>("Bundle"==e.resourceType?await Promise.all((e.entry||[]).map((e=>Y(e.resource,s,r,this,a)))):await Y(e,s,r,this,a),e))(t).then((async e=>{if(e&&"Bundle"==e.resourceType){const t=e.link||[];if(s.flat&&(e=(e.entry||[]).map((e=>e.resource))),s.onPage&&await s.onPage(e,Object.assign({},r)),--s.pageLimit){const n=t.find((e=>"next"==e.relation));if(e=(0,u.makeArray)(e),n&&n.url){const t=await this.request({url:n.url,signal:a},s,r);return s.onPage?null:s.resolveReferences.length?(Object.assign(r,t.references),e.concat((0,u.makeArray)(t.data||t))):e.concat((0,u.makeArray)(t))}}}return e})).then((e=>{if(s.graph)r={};else if(!s.onPage&&s.resolveReferences.length)return{data:e,references:r};return e})).then((t=>e.includeResponse?{body:t,response:c}:t)):t))}refreshIfNeeded(e={}){const t=this.getState("tokenResponse.access_token"),r=this.getState("tokenResponse.refresh_token"),n=this.state.expiresAt||0;return t&&r&&n-10<Date.now()/1e3?this.refresh(e):Promise.resolve(this.state)}refresh(e={}){var t,r;const n=u.debug.extend("client:refresh");n("Attempting to refresh with refresh_token...");const o=null===(r=null===(t=this.state)||void 0===t?void 0:t.tokenResponse)||void 0===r?void 0:r.refresh_token;(0,u.assert)(o,"Unable to refresh. No refresh_token found.");const i=this.state.tokenUri;(0,u.assert)(i,"Unable to refresh. No tokenUri found.");const s=this.getState("tokenResponse.scope")||"",a=s.search(/\boffline_access\b/)>-1,c=s.search(/\bonline_access\b/)>-1;if((0,u.assert)(a||c,"Unable to refresh. No offline_access or online_access scope found."),!this._refreshTask){const t=Object.assign(Object.assign({credentials:this.environment.options.refreshTokenWithCredentials||"same-origin"},e),{method:"POST",mode:"cors",headers:Object.assign(Object.assign({},e.headers||{}),{"content-type":"application/x-www-form-urlencoded"}),body:`grant_type=refresh_token&refresh_token=${encodeURIComponent(o)}`});if(!("authorization"in t.headers)){const{clientSecret:e,clientId:r}=this.state;e&&(t.headers.authorization="Basic "+this.environment.btoa(r+":"+e))}this._refreshTask=(0,u.request)(i,t).then((e=>((0,u.assert)(e.access_token,"No access token received"),n("Received new access token response %O",e),this.state.tokenResponse=Object.assign(Object.assign({},this.state.tokenResponse),e),this.state.expiresAt=(0,u.getAccessTokenExpiration)(e,this.environment),this.state))).catch((e=>{var t,r;throw(null===(r=null===(t=this.state)||void 0===t?void 0:t.tokenResponse)||void 0===r?void 0:r.refresh_token)&&(n("Deleting the expired or invalid refresh token."),delete this.state.tokenResponse.refresh_token),e})).finally((()=>{this._refreshTask=null;const e=this.state.key;e?this.environment.getStorage().set(e,this.state):n("No 'key' found in Clint.state. Cannot persist the instance.")}))}return this._refreshTask}byCode(e,t){return(0,u.byCode)(e,t)}byCodes(e,t){return(0,u.byCodes)(e,t)}getPath(e,t=""){return(0,u.getPath)(e,t)}getState(e=""){return(0,u.getPath)(Object.assign({},this.state),e)}getFhirVersion(){return(0,u.fetchConformanceStatement)(this.state.serverUrl).then((e=>e.fhirVersion))}getFhirRelease(){return this.getFhirVersion().then((e=>{var t;return null!==(t=l.fhirVersions[e])&&void 0!==t?t:0}))}},Object.defineProperty(a,"KEY",{enumerable:!0,get:function(){return l.SMART_KEY}});const V=u.debug.extend("oauth2");function G(){return"object"==typeof window}function Z(e="/",t){const r=String(e).replace(/\/*$/,"/")+".well-known/smart-configuration";return(0,u.getAndCache)(r,t).catch((e=>{throw new Error(`Failed to fetch the well-known json "${r}". ${e.message}`)}))}function Q(e="/"){return function(e="/",t){return Z(e,void 0).then((e=>{if(!e.authorization_endpoint||!e.token_endpoint)throw new Error("Invalid wellKnownJson");return{registrationUri:e.registration_endpoint||"",authorizeUri:e.authorization_endpoint,tokenUri:e.token_endpoint,codeChallengeMethods:e.code_challenge_methods_supported||[]}}))}(e).catch((()=>function(e="/",t){return(0,u.fetchConformanceStatement)(e,t).then((e=>{const t=((0,u.getPath)(e||{},"rest.0.security.extension")||[]).filter((e=>"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris"===e.url)).map((e=>e.extension))[0],r={registrationUri:"",authorizeUri:"",tokenUri:"",codeChallengeMethods:[]};return t&&t.forEach((e=>{"register"===e.url&&(r.registrationUri=e.valueUri),"authorize"===e.url&&(r.authorizeUri=e.valueUri),"token"===e.url&&(r.tokenUri=e.valueUri)})),r}))}(e)))}async function X(e,t={}){const r=e.getUrl();if(Array.isArray(t)){const n=r.searchParams.get("iss")||r.searchParams.get("fhirServiceUrl");if(!n)throw new Error('Passing in an "iss" url parameter is required if authorize uses multiple configurations');const o=t.find((e=>{if(e.issMatch){if("function"==typeof e.issMatch)return!!e.issMatch(n);if("string"==typeof e.issMatch)return e.issMatch===n;if(e.issMatch instanceof RegExp)return e.issMatch.test(n)}return!1}));return(0,u.assert)(o,`No configuration found matching the current "iss" parameter "${n}"`),await X(e,o)}const{redirect_uri:n,clientSecret:o,fakeTokenResponse:i,patientId:s,encounterId:a,client_id:c,target:f,width:h,height:p,pkceMode:d,clientPublicKeySetUrl:y}=t;let{iss:g,launch:b,fhirServiceUrl:m,redirectUri:w,noRedirect:v,scope:A="",clientId:E,completeInTarget:C,clientPrivateJwk:S}=t;const O=e.getStorage();g=r.searchParams.get("iss")||g,m=r.searchParams.get("fhirServiceUrl")||m,b=r.searchParams.get("launch")||b,E||(E=c),w||(w=n),w?w.match(/^https?\:\/\//)||(w=e.relative(w)):w=e.relative(".");const k=String(g||m||"");if(!k)throw new Error("No server url found. It must be specified as `iss` or as `fhirServiceUrl` parameter");if(g&&V("Making %s launch...",b?"EHR":"standalone"),b&&!A.match(/launch/)&&(A+=" launch"),G()){const e=ee(),t=te();(e||t)&&!0!==C&&!1!==C&&(C=e,console.warn('Your app is being authorized from within an iframe or popup window. Please be explicit and provide a "completeInTarget" option. Use "true" to complete the authorization in the same window, or "false" to try to complete it in the parent or the opener window. See http://docs.smarthealthit.org/client-js/api.html'))}const _=await O.get(l.SMART_KEY);await O.unset(_);const P=(0,u.randomString)(16),R={clientId:E,scope:A,redirectUri:w,serverUrl:k,clientSecret:o,clientPrivateJwk:S,tokenResponse:{},key:P,completeInTarget:C,clientPublicKeySetUrl:y};(!G()||(0,u.getPath)(e,"options.fullSessionStorageSupport"))&&await O.set(l.SMART_KEY,P),i&&Object.assign(R.tokenResponse,i),s&&Object.assign(R.tokenResponse,{patient:s}),a&&Object.assign(R.tokenResponse,{encounter:a});let T=w+"?state="+encodeURIComponent(P);if(m&&!g)return V("Making fake launch..."),await O.set(P,R),v?T:await e.redirect(T);const U=await Q(k);if(Object.assign(R,U),await O.set(P,R),!R.authorizeUri)return v?T:await e.redirect(T);const j=["response_type=code","client_id="+encodeURIComponent(E||""),"scope="+encodeURIComponent(A),"redirect_uri="+encodeURIComponent(w),"aud="+encodeURIComponent(k),"state="+encodeURIComponent(P)];if(b&&j.push("launch="+encodeURIComponent(b)),function(e,t){if("disabled"===t)return!1;if("unsafeV1"===t)return!0;if("required"===t){if(!e)throw new Error("Required PKCE code challenge method (`S256`) was not found.");return!0}return e}(U.codeChallengeMethods.includes("S256"),d)){let t=await e.security.generatePKCEChallenge();Object.assign(R,t),await O.set(P,R),j.push("code_challenge="+R.codeChallenge),j.push("code_challenge_method=S256")}if(T=R.authorizeUri+"?"+j.join("&"),v)return T;if(!f||!G())return await e.redirect(T);{let e;if(e=await(0,u.getTargetWindow)(f,h,p),e!==self)try{e.sessionStorage.removeItem(_),e.sessionStorage.setItem(P,JSON.stringify(R))}catch(t){(0,u.debug)('Failed to modify window.sessionStorage. Perhaps it is from different origin?. Failing back to "_self". %s',t),e=self}if(e!==self)try{e.location.href=T,self.addEventListener("message",re)}catch(e){(0,u.debug)('Failed to modify window.location. Perhaps it is from different origin?. Failing back to "_self". %s',e),self.location.href=T}else self.location.href=T}}function ee(){try{return self!==top&&parent!==self}catch(e){return!0}}function te(){try{return self===top&&!!opener&&opener!==self&&!!window.name}catch(e){return!1}}function re(e){"completeAuth"==e.data.type&&e.origin===new URL(self.location.href).origin&&(window.removeEventListener("message",re),window.location.href=e.data.url)}async function ne(e,t={}){var r,n;const o=e.getUrl(),i=e.getStorage(),s=o.searchParams;let a=s.get("state");const c=s.get("code"),f=s.get("error"),h=s.get("error_description");if(a||(a=await i.get(l.SMART_KEY)),f||h)throw new Error([f,h].filter(Boolean).join(": "));V("key: %s, code: %s",a,c),(0,u.assert)(a,"No 'state' parameter found. Please (re)launch the app.");let p=await i.get(a);const d=!G()||(0,u.getPath)(e,"options.fullSessionStorageSupport");if(G()&&p&&!p.completeInTarget){const e=ee(),t=te();if((e||t)&&!o.searchParams.get("complete")){o.searchParams.set("complete","1");const{href:r,origin:n}=o;return e&&parent.postMessage({type:"completeAuth",url:r},n),t&&(opener.postMessage({type:"completeAuth",url:r},n),window.close()),new Promise((()=>{}))}}o.searchParams.delete("complete");const y=s.has("state");if(G()&&(0,u.getPath)(e,"options.replaceBrowserHistory")&&(c||y)&&(c&&(s.delete("code"),V("Removed code parameter from the url.")),y&&d&&(s.delete("state"),V("Removed state parameter from the url.")),window.history.replaceState&&window.history.replaceState({},"",o.href)),(0,u.assert)(p,"No state found! Please (re)launch the app."),c&&!(null===(r=p.tokenResponse)||void 0===r?void 0:r.access_token)&&p.tokenUri){(0,u.assert)(c,"'code' url parameter is required"),V("Preparing to exchange the code for access token...");const r=await oe(e,{code:c,state:p,clientPublicKeySetUrl:t.clientPublicKeySetUrl,privateKey:t.privateKey||p.clientPrivateJwk});V("Token request options: %O",r);const n=await(0,u.request)(p.tokenUri,r);V("Token response: %O",n),(0,u.assert)(n.access_token,"Failed to obtain access token."),p.expiresAt=(0,u.getAccessTokenExpiration)(n,e),p=Object.assign(Object.assign({},p),{tokenResponse:n}),await i.set(a,p),V("Authorization successful!")}else V((null===(n=p.tokenResponse)||void 0===n?void 0:n.access_token)?"Already authorized":"No authorization needed");d&&await i.set(l.SMART_KEY,a);const g=new z.default(e,p);return V("Created client instance: %O",g),g}async function oe(e,{code:t,state:r,clientPublicKeySetUrl:n,privateKey:o}){const{redirectUri:i,clientSecret:s,tokenUri:a,clientId:c,codeVerifier:f}=r;(0,u.assert)(i,"Missing state.redirectUri"),(0,u.assert)(a,"Missing state.tokenUri"),(0,u.assert)(c,"Missing state.clientId");const l={method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:`code=${t}&grant_type=authorization_code&redirect_uri=${encodeURIComponent(i)}`};if(s)l.headers.authorization="Basic "+e.btoa(c+":"+s),V("Using state.clientSecret to construct the authorization header: %s",l.headers.authorization);else if(o){const t="key"in o?o.key:await e.security.importJWK(o),i={typ:"JWT",kid:o.kid,jku:n||r.clientPublicKeySetUrl},s={iss:c,sub:c,aud:a,jti:e.base64urlencode(e.security.randomBytes(32)),exp:(0,u.getTimeInFuture)(120)},f=await e.security.signCompactJws(o.alg,t,i,s);l.body+=`&client_assertion_type=${encodeURIComponent("urn:ietf:params:oauth:client-assertion-type:jwt-bearer")}`,l.body+=`&client_assertion=${encodeURIComponent(f)}`,V("Using state.clientPrivateJwk to add a client_assertion to the POST body")}else V("Public client detected; adding state.clientId to the POST body"),l.body+=`&client_id=${encodeURIComponent(c)}`;return f&&(V("Found state.codeVerifier, adding to the POST body"),l.body+="&code_verifier="+f),l}a.fetchWellKnownJson=Z,a.getSecurityExtensions=Q,a.authorize=X,a.isInFrame=ee,a.isInPopUp=te,a.onMessage=re,a.ready=ne,a.buildTokenRequest=oe,a.init=async function(e,t,r){const n=e.getUrl(),o=n.searchParams.get("code"),i=n.searchParams.get("state");if(o&&i)return ne(e,r);const s=e.getStorage(),a=i||await s.get(l.SMART_KEY),u=await s.get(a);return u?new z.default(e,u):X(e,t).then((()=>new Promise((()=>{}))))};var ie={};Object.defineProperty(ie,"__esModule",{value:!0}),ie.default=class{async get(e){const t=sessionStorage[e];return t?JSON.parse(t):null}async set(e,t){return sessionStorage[e]=JSON.stringify(t),t}async unset(e){return e in sessionStorage&&(delete sessionStorage[e],!0)}};var se={},ae={},ue=function(e){return e&&e.Math==Math&&e};ae=ue("object"==typeof globalThis&&globalThis)||ue("object"==typeof window&&window)||ue("object"==typeof self&&self)||ue("object"==typeof r&&r)||function(){return this}()||Function("return this")();var ce,fe,le={};ce=!(fe=function(e){try{return!!e()}catch(e){return!0}})((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}));var he,pe,de,ye=Function.prototype.call;le=ce?ye.bind(ye):function(){return ye.apply(ye,arguments)},pe="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,de=!fe((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}));var ge,be={},me="object"==typeof document&&document.all,we=(ge={all:me,IS_HTMLDDA:void 0===me&&void 0!==me}).all;be=ge.IS_HTMLDDA?function(e){return"function"==typeof e||e===we}:function(e){return"function"==typeof e};var ve={},Ae=ge.all;ve=ge.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:be(e)||e===Ae}:function(e){return"object"==typeof e?null!==e:be(e)};var Ee,Ce,Se,Oe={},ke={},_e=Function.prototype,Pe=_e.call,Re=ce&&_e.bind.bind(Pe,Pe);ke=ce?Re:function(e){return function(){return Pe.apply(e,arguments)}},Se=function(e){return null==e};var Te=TypeError;Ce=function(e){if(Se(e))throw Te("Can't call method on "+e);return e};var Ue=Object;Ee=function(e){return Ue(Ce(e))};var je=ke({}.hasOwnProperty);Oe=Object.hasOwn||function(e,t){return je(Ee(e),t)};var xe,Ie,Fe,Be,Me={},Le={},Ke=Object.defineProperty;Be=function(e,t){try{Ke(ae,e,{value:t,configurable:!0,writable:!0})}catch(r){ae[e]=t}return t};var De=ae["__core-js_shared__"]||Be("__core-js_shared__",{});Le=De,(Fe=function(e,t){return Le[e]||(Le[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.1",mode:"global",copyright:" 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"});var qe,Ne=0,ze=Math.random(),He=ke(1..toString);qe=function(e){return"Symbol("+(void 0===e?"":e)+")_"+He(++Ne+ze,36)};var $e,Je,We,Ye={},Ve=function(e){return be(e)?e:void 0};Ye=(We=function(e,t){return arguments.length<2?Ve(ae[e]):ae[e]&&ae[e][t]})("navigator","userAgent")||"";var Ge,Ze,Qe,Xe=ae.process,et=ae.Deno,tt=Xe&&Xe.versions||et&&et.version,rt=tt&&tt.v8;rt&&(Ze=(Ge=rt.split("."))[0]>0&&Ge[0]<4?1:+(Ge[0]+Ge[1])),!Ze&&Ye&&(!(Ge=Ye.match(/Edge\/(\d+)/))||Ge[1]>=74)&&(Ge=Ye.match(/Chrome\/(\d+)/))&&(Ze=+Ge[1]),Je=Ze,$e=!!Object.getOwnPropertySymbols&&!fe((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Je&&Je<41})),Qe=$e&&!Symbol.sham&&"symbol"==typeof Symbol.iterator;var nt=Fe("wks"),ot=ae.Symbol,it=ot&&ot.for,st=Qe?ot:ot&&ot.withoutSetter||qe,at={};at[(Ie=function(e){if(!Oe(nt,e)||!$e&&"string"!=typeof nt[e]){var t="Symbol."+e;$e&&Oe(ot,e)?nt[e]=ot[e]:nt[e]=Qe&&it?it(t):st(t)}return nt[e]})("toStringTag")]="z",xe="[object z]"===String(at);var ut,ct=ke({}.toString),ft=ke("".slice);ut=function(e){return ft(ct(e),8,-1)};var lt=Ie("toStringTag"),ht=Object,pt="Arguments"==ut(function(){return arguments}());Me=xe?ut:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=ht(e),lt))?r:pt?ut(t):"Object"==(n=ut(t))&&be(t.callee)?"Arguments":n};var dt,yt=String;dt=function(e){try{return yt(e)}catch(e){return"Object"}};var gt,bt,mt,wt,vt={},At=ae.document,Et=ve(At)&&ve(At.createElement);mt=function(e){return Et?At.createElement(e):{}},bt=!de&&!fe((function(){return 7!=Object.defineProperty(mt("div"),"a",{get:function(){return 7}}).a})),wt=de&&fe((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}));var Ct,St=String,Ot=TypeError;Ct=function(e){if(ve(e))return e;throw Ot(St(e)+" is not an object")};var kt,_t,Pt={},Rt={};Rt=ke({}.isPrototypeOf);var Tt=Object;Pt=Qe?function(e){return"symbol"==typeof e}:function(e){var t=We("Symbol");return be(t)&&Rt(t.prototype,Tt(e))};var Ut,jt,xt=TypeError;jt=function(e){if(be(e))return e;throw xt(dt(e)+" is not a function")},Ut=function(e,t){var r=e[t];return Se(r)?void 0:jt(r)};var It,Ft=TypeError;It=function(e,t){var r,n;if("string"===t&&be(r=e.toString)&&!ve(n=le(r,e)))return n;if(be(r=e.valueOf)&&!ve(n=le(r,e)))return n;if("string"!==t&&be(r=e.toString)&&!ve(n=le(r,e)))return n;throw Ft("Can't convert object to primitive value")};var Bt=TypeError,Mt=Ie("toPrimitive");_t=function(e,t){if(!ve(e)||Pt(e))return e;var r,n=Ut(e,Mt);if(n){if(void 0===t&&(t="default"),r=le(n,e,t),!ve(r)||Pt(r))return r;throw Bt("Can't convert object to primitive value")}return void 0===t&&(t="number"),It(e,t)},kt=function(e){var t=_t(e,"string");return Pt(t)?t:t+""};var Lt,Kt=TypeError,Dt=Object.defineProperty,qt=Object.getOwnPropertyDescriptor;gt=de?wt?function(e,t,r){if(Ct(e),t=kt(t),Ct(r),"function"==typeof e&&"prototype"===t&&"value"in r&&"writable"in r&&!r.writable){var n=qt(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Dt(e,t,r)}:Dt:function(e,t,r){if(Ct(e),t=kt(t),Ct(r),bt)try{return Dt(e,t,r)}catch(e){}if("get"in r||"set"in r)throw Kt("Accessors not supported");return"value"in r&&(e[t]=r.value),e},Lt=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},vt=de?function(e,t,r){return gt(e,t,Lt(1,r))}:function(e,t,r){return e[t]=r,e};var Nt,zt,Ht=Function.prototype,$t=de&&Object.getOwnPropertyDescriptor,Jt=Oe(Ht,"name"),Wt=Jt&&(!de||de&&$t(Ht,"name").configurable),Yt={},Vt=ke(Function.toString);be(Le.inspectSource)||(Le.inspectSource=function(e){return Vt(e)}),Yt=Le.inspectSource;var Gt,Zt,Qt=ae.WeakMap;Zt=be(Qt)&&/native code/.test(String(Qt));var Xt,er=Fe("keys");Xt=function(e){return er[e]||(er[e]=qe(e))};var tr={};tr={};var rr,nr,or,ir="Object already initialized",sr=ae.TypeError,ar=ae.WeakMap;if(Zt||Le.state){var ur=Le.state||(Le.state=new ar);ur.get=ur.get,ur.has=ur.has,ur.set=ur.set,rr=function(e,t){if(ur.has(e))throw sr(ir);return t.facade=e,ur.set(e,t),t},nr=function(e){return ur.get(e)||{}},or=function(e){return ur.has(e)}}else{var cr=Xt("state");tr[cr]=!0,rr=function(e,t){if(Oe(e,cr))throw sr(ir);return t.facade=e,vt(e,cr,t),t},nr=function(e){return Oe(e,cr)?e[cr]:{}},or=function(e){return Oe(e,cr)}}var fr=(Gt={set:rr,get:nr,has:or,enforce:function(e){return or(e)?nr(e):rr(e,{})},getterFor:function(e){return function(t){var r;if(!ve(t)||(r=nr(t)).type!==e)throw sr("Incompatible receiver, "+e+" required");return r}}}).enforce,lr=Gt.get,hr=Object.defineProperty,pr=de&&!fe((function(){return 8!==hr((function(){}),"length",{value:8}).length})),dr=String(String).split("String"),yr=zt=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!Oe(e,"name")||Wt&&e.name!==t)&&(de?hr(e,"name",{value:t,configurable:!0}):e.name=t),pr&&r&&Oe(r,"arity")&&e.length!==r.arity&&hr(e,"length",{value:r.arity});try{r&&Oe(r,"constructor")&&r.constructor?de&&hr(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=fr(e);return Oe(n,"source")||(n.source=dr.join("string"==typeof t?t:"")),e};Function.prototype.toString=yr((function(){return be(this)&&lr(this).source||Yt(this)}),"toString"),Nt=function(e,t,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:t;if(be(r)&&zt(r,i,n),n.global)o?e[t]=r:Be(t,r);else{try{n.unsafe?e[t]&&(o=!0):delete e[t]}catch(e){}o?e[t]=r:gt(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e};var gr,br=gt,mr={};gr=!fe((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}));var wr=Xt("IE_PROTO"),vr=Object,Ar=vr.prototype;mr=gr?vr.getPrototypeOf:function(e){var t=Ee(e);if(Oe(t,wr))return t[wr];var r=t.constructor;return be(r)&&t instanceof r?r.prototype:t instanceof vr?Ar:null};var Er,Cr={},Sr=String,Or=TypeError;Er=function(e){if("object"==typeof e||be(e))return e;throw Or("Can't set "+Sr(e)+" as a prototype")},Cr=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=ke(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return Ct(r),Er(n),t?e(r,n):r.__proto__=n,r}}():void 0);var kr,_r,Pr,Rr=Gt.enforce,Tr=Gt.get,Ur=ae.Int8Array,jr=Ur&&Ur.prototype,xr=ae.Uint8ClampedArray,Ir=xr&&xr.prototype,Fr=Ur&&mr(Ur),Br=jr&&mr(jr),Mr=Object.prototype,Lr=ae.TypeError,Kr=Ie("toStringTag"),Dr=qe("TYPED_ARRAY_TAG"),qr=pe&&!!Cr&&"Opera"!==Me(ae.opera),Nr=!1,zr={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Hr={BigInt64Array:8,BigUint64Array:8},$r=function(e){var t=mr(e);if(ve(t)){var r=Tr(t);return r&&Oe(r,"TypedArrayConstructor")?r.TypedArrayConstructor:$r(t)}},Jr=function(e){if(!ve(e))return!1;var t=Me(e);return Oe(zr,t)||Oe(Hr,t)};for(kr in zr)(Pr=(_r=ae[kr])&&_r.prototype)?Rr(Pr).TypedArrayConstructor=_r:qr=!1;for(kr in Hr)(Pr=(_r=ae[kr])&&_r.prototype)&&(Rr(Pr).TypedArrayConstructor=_r);if((!qr||!be(Fr)||Fr===Function.prototype)&&(Fr=function(){throw Lr("Incorrect invocation")},qr))for(kr in zr)ae[kr]&&Cr(ae[kr],Fr);if((!qr||!Br||Br===Mr)&&(Br=Fr.prototype,qr))for(kr in zr)ae[kr]&&Cr(ae[kr].prototype,Br);if(qr&&mr(Ir)!==Br&&Cr(Ir,Br),de&&!Oe(Br,Kr))for(kr in Nr=!0,br(Br,Kr,{get:function(){return ve(this)?this[Dr]:void 0}}),zr)ae[kr]&&vt(ae[kr],Dr,kr);he={NATIVE_ARRAY_BUFFER_VIEWS:qr,TYPED_ARRAY_TAG:Nr&&Dr,aTypedArray:function(e){if(Jr(e))return e;throw Lr("Target is not a typed array")},aTypedArrayConstructor:function(e){if(be(e)&&(!Cr||Rt(Fr,e)))return e;throw Lr(dt(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(de){if(r)for(var o in zr){var i=ae[o];if(i&&Oe(i.prototype,e))try{delete i.prototype[e]}catch(r){try{i.prototype[e]=t}catch(e){}}}Br[e]&&!r||Nt(Br,e,r?t:qr&&jr[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,o;if(de){if(Cr){if(r)for(n in zr)if((o=ae[n])&&Oe(o,e))try{delete o[e]}catch(e){}if(Fr[e]&&!r)return;try{return Nt(Fr,e,r?t:qr&&Fr[e]||t)}catch(e){}}for(n in zr)!(o=ae[n])||o[e]&&!r||Nt(o,e,t)}},getTypedArrayConstructor:$r,isView:function(e){if(!ve(e))return!1;var t=Me(e);return"DataView"===t||Oe(zr,t)||Oe(Hr,t)},isTypedArray:Jr,TypedArray:Fr,TypedArrayPrototype:Br};var Wr,Yr,Vr,Gr={},Zr=Math.ceil,Qr=Math.floor;Gr=Math.trunc||function(e){var t=+e;return(t>0?Qr:Zr)(t)},Vr=function(e){var t=+e;return t!=t||0===t?0:Gr(t)};var Xr=Math.min;Yr=function(e){return e>0?Xr(Vr(e),9007199254740991):0},Wr=function(e){return Yr(e.length)};var en,tn,rn=RangeError;tn=function(e){var t=Vr(e);if(t<0)throw rn("The argument can't be less than 0");return t};var nn=RangeError;en=function(e,t){var r=tn(e);if(r%t)throw nn("Wrong offset");return r};var on,sn,an,un=ae.RangeError,cn=ae.Int8Array,fn=cn&&cn.prototype,ln=fn&&fn.set,hn=he.aTypedArray,pn=he.exportTypedArrayMethod,dn=!fe((function(){var e=new Uint8ClampedArray(2);return le(ln,e,{length:1,0:3},1),3!==e[1]})),yn=dn&&he.NATIVE_ARRAY_BUFFER_VIEWS&&fe((function(){var e=new cn(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));pn("set",(function(e){hn(this);var t=en(arguments.length>1?arguments[1]:void 0,1),r=Ee(e);if(dn)return le(ln,this,r,t);var n=this.length,o=Wr(r),i=0;if(o+t>n)throw un("Wrong length");for(;i<o;)this[t+i]=r[i++]}),!dn||yn),Object.defineProperty(se,"__esModule",{value:!0}),se.signCompactJws=se.importJWK=se.generatePKCEChallenge=se.digestSha256=se.randomBytes=void 0,sn=function(e){var t,r,n=function(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}(e),o=n[0],i=n[1],s=new vn(function(e,t,r){return 3*(t+r)/4-r}(0,o,i)),a=0,u=i>0?o-4:o;for(r=0;r<u;r+=4)t=wn[e.charCodeAt(r)]<<18|wn[e.charCodeAt(r+1)]<<12|wn[e.charCodeAt(r+2)]<<6|wn[e.charCodeAt(r+3)],s[a++]=t>>16&255,s[a++]=t>>8&255,s[a++]=255&t;return 2===i&&(t=wn[e.charCodeAt(r)]<<2|wn[e.charCodeAt(r+1)]>>4,s[a++]=255&t),1===i&&(t=wn[e.charCodeAt(r)]<<10|wn[e.charCodeAt(r+1)]<<4|wn[e.charCodeAt(r+2)]>>2,s[a++]=t>>8&255,s[a++]=255&t),s},an=function(e){for(var t,r=e.length,n=r%3,o=[],i=16383,s=0,a=r-n;s<a;s+=i)o.push(Sn(e,s,s+i>a?a:s+i));return 1===n?(t=e[r-1],o.push(mn[t>>2]+mn[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],o.push(mn[t>>10]+mn[t>>4&63]+mn[t<<2&63]+"=")),o.join("")}/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */;for(var gn,bn,mn=[],wn=[],vn="undefined"!=typeof Uint8Array?Uint8Array:Array,An="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",En=0,Cn=An.length;En<Cn;++En)mn[En]=An[En],wn[An.charCodeAt(En)]=En;function Sn(e,t,r){for(var n,o,i=[],s=t;s<r;s+=3)n=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),i.push(mn[(o=n)>>18&63]+mn[o>>12&63]+mn[o>>6&63]+mn[63&o]);return i.join("")}wn["-".charCodeAt(0)]=62,wn["_".charCodeAt(0)]=63,gn=function(e,t,r,n,o){var i,s,a=8*o-n-1,u=(1<<a)-1,c=u>>1,f=-7,l=r?o-1:0,h=r?-1:1,p=e[t+l];for(l+=h,i=p&(1<<-f)-1,p>>=-f,f+=a;f>0;i=256*i+e[t+l],l+=h,f-=8);for(s=i&(1<<-f)-1,i>>=-f,f+=n;f>0;s=256*s+e[t+l],l+=h,f-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),i-=c}return(p?-1:1)*s*Math.pow(2,i-n)},bn=function(e,t,r,n,o,i){var s,a,u,c=8*i-o-1,f=(1<<c)-1,l=f>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:i-1,d=n?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=f):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+l>=1?h/u:h*Math.pow(2,1-l))*u>=2&&(s++,u/=2),s+l>=f?(a=0,s=f):s+l>=1?(a=(t*u-1)*Math.pow(2,o),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,o),s=0));o>=8;e[r+p]=255&a,p+=d,a/=256,o-=8);for(s=s<<o|a,c+=o;c>0;e[r+p]=255&s,p+=d,s/=256,c-=8);e[r+p-d]|=128*y};var On="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;on=Pn;var kn=2147483647;function _n(e){if(e>kn)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,Pn.prototype),t}function Pn(e,t,r){if("number"==typeof e){if("string"==typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return Un(e)}return Rn(e,t,r)}function Rn(e,t,r){if("string"==typeof e)return function(e,t){if("string"==typeof t&&""!==t||(t="utf8"),!Pn.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var r=0|Fn(e,t),n=_n(r),o=n.write(e,t);return o!==r&&(n=n.slice(0,o)),n}(e,t);if(ArrayBuffer.isView(e))return function(e){if(ao(e,Uint8Array)){var t=new Uint8Array(e);return xn(t.buffer,t.byteOffset,t.byteLength)}return jn(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(ao(e,ArrayBuffer)||e&&ao(e.buffer,ArrayBuffer))return xn(e,t,r);if("undefined"!=typeof SharedArrayBuffer&&(ao(e,SharedArrayBuffer)||e&&ao(e.buffer,SharedArrayBuffer)))return xn(e,t,r);if("number"==typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=e.valueOf&&e.valueOf();if(null!=n&&n!==e)return Pn.from(n,t,r);var o=function(e){if(Pn.isBuffer(e)){var t=0|In(e.length),r=_n(t);return 0===r.length||e.copy(r,0,0,t),r}return void 0!==e.length?"number"!=typeof e.length||uo(e.length)?_n(0):jn(e):"Buffer"===e.type&&Array.isArray(e.data)?jn(e.data):void 0}(e);if(o)return o;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof e[Symbol.toPrimitive])return Pn.from(e[Symbol.toPrimitive]("string"),t,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function Tn(e){if("number"!=typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function Un(e){return Tn(e),_n(e<0?0:0|In(e))}function jn(e){for(var t=e.length<0?0:0|In(e.length),r=_n(t),n=0;n<t;n+=1)r[n]=255&e[n];return r}function xn(e,t,r){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===t&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,t):new Uint8Array(e,t,r),Object.setPrototypeOf(n,Pn.prototype),n}function In(e){if(e>=kn)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kn.toString(16)+" bytes");return 0|e}function Fn(e,t){if(Pn.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||ao(e,ArrayBuffer))return e.byteLength;if("string"!=typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var r=e.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return oo(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return io(e).length;default:if(o)return n?-1:oo(e).length;t=(""+t).toLowerCase(),o=!0}}function Bn(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Gn(this,t,r);case"utf8":case"utf-8":return Jn(this,t,r);case"ascii":return Yn(this,t,r);case"latin1":case"binary":return Vn(this,t,r);case"base64":return $n(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Zn(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function Mn(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Ln(e,t,r,n,o){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),uo(r=+r)&&(r=o?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(o)return-1;r=e.length-1}else if(r<0){if(!o)return-1;r=0}if("string"==typeof t&&(t=Pn.from(t,n)),Pn.isBuffer(t))return 0===t.length?-1:Kn(e,t,r,n,o);if("number"==typeof t)return t&=255,"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):Kn(e,[t],r,n,o);throw new TypeError("val must be string, number or Buffer")}function Kn(e,t,r,n,o){var i,s=1,a=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,r/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(o){var f=-1;for(i=r;i<a;i++)if(c(e,i)===c(t,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===u)return f*s}else-1!==f&&(i-=i-f),f=-1}else for(r+u>a&&(r=a-u),i=r;i>=0;i--){for(var l=!0,h=0;h<u;h++)if(c(e,i+h)!==c(t,h)){l=!1;break}if(l)return i}return-1}function Dn(e,t,r,n){r=Number(r)||0;var o=e.length-r;n?(n=Number(n))>o&&(n=o):n=o;var i=t.length;n>i/2&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(t.substr(2*s,2),16);if(uo(a))return s;e[r+s]=a}return s}function qn(e,t,r,n){return so(oo(t,e.length-r),e,r,n)}function Nn(e,t,r,n){return so(function(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}(t),e,r,n)}function zn(e,t,r,n){return so(io(t),e,r,n)}function Hn(e,t,r,n){return so(function(e,t){for(var r,n,o,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=(r=e.charCodeAt(s))>>8,o=r%256,i.push(o),i.push(n);return i}(t,e.length-r),e,r,n)}function $n(e,t,r){return 0===t&&r===e.length?an(e):an(e.slice(t,r))}function Jn(e,t,r){r=Math.min(e.length,r);for(var n=[],o=t;o<r;){var i,s,a,u,c=e[o],f=null,l=c>239?4:c>223?3:c>191?2:1;if(o+l<=r)switch(l){case 1:c<128&&(f=c);break;case 2:128==(192&(i=e[o+1]))&&(u=(31&c)<<6|63&i)>127&&(f=u);break;case 3:i=e[o+1],s=e[o+2],128==(192&i)&&128==(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s)>2047&&(u<55296||u>57343)&&(f=u);break;case 4:i=e[o+1],s=e[o+2],a=e[o+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(f=u)}null===f?(f=65533,l=1):f>65535&&(f-=65536,n.push(f>>>10&1023|55296),f=56320|1023&f),n.push(f),o+=l}return function(e){var t=e.length;if(t<=Wn)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Wn));return r}(n)}Pn.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),Pn.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Pn.prototype,"parent",{enumerable:!0,get:function(){if(Pn.isBuffer(this))return this.buffer}}),Object.defineProperty(Pn.prototype,"offset",{enumerable:!0,get:function(){if(Pn.isBuffer(this))return this.byteOffset}}),Pn.poolSize=8192,Pn.from=function(e,t,r){return Rn(e,t,r)},Object.setPrototypeOf(Pn.prototype,Uint8Array.prototype),Object.setPrototypeOf(Pn,Uint8Array),Pn.alloc=function(e,t,r){return function(e,t,r){return Tn(e),e<=0?_n(e):void 0!==t?"string"==typeof r?_n(e).fill(t,r):_n(e).fill(t):_n(e)}(e,t,r)},Pn.allocUnsafe=function(e){return Un(e)},Pn.allocUnsafeSlow=function(e){return Un(e)},Pn.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==Pn.prototype},Pn.compare=function(e,t){if(ao(e,Uint8Array)&&(e=Pn.from(e,e.offset,e.byteLength)),ao(t,Uint8Array)&&(t=Pn.from(t,t.offset,t.byteLength)),!Pn.isBuffer(e)||!Pn.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var r=e.length,n=t.length,o=0,i=Math.min(r,n);o<i;++o)if(e[o]!==t[o]){r=e[o],n=t[o];break}return r<n?-1:n<r?1:0},Pn.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Pn.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return Pn.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=Pn.allocUnsafe(t),o=0;for(r=0;r<e.length;++r){var i=e[r];if(ao(i,Uint8Array))o+i.length>n.length?Pn.from(i).copy(n,o):Uint8Array.prototype.set.call(n,i,o);else{if(!Pn.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(n,o)}o+=i.length}return n},Pn.byteLength=Fn,Pn.prototype._isBuffer=!0,Pn.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)Mn(this,t,t+1);return this},Pn.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)Mn(this,t,t+3),Mn(this,t+1,t+2);return this},Pn.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)Mn(this,t,t+7),Mn(this,t+1,t+6),Mn(this,t+2,t+5),Mn(this,t+3,t+4);return this},Pn.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?Jn(this,0,e):Bn.apply(this,arguments)},Pn.prototype.toLocaleString=Pn.prototype.toString,Pn.prototype.equals=function(e){if(!Pn.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===Pn.compare(this,e)},Pn.prototype.inspect=function(){var e="";return e=this.toString("hex",0,50).replace(/(.{2})/g,"$1 ").trim(),this.length>50&&(e+=" ... "),"<Buffer "+e+">"},On&&(Pn.prototype[On]=Pn.prototype.inspect),Pn.prototype.compare=function(e,t,r,n,o){if(ao(e,Uint8Array)&&(e=Pn.from(e,e.offset,e.byteLength)),!Pn.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===o&&(o=this.length),t<0||r>e.length||n<0||o>this.length)throw new RangeError("out of range index");if(n>=o&&t>=r)return 0;if(n>=o)return-1;if(t>=r)return 1;if(this===e)return 0;for(var i=(o>>>=0)-(n>>>=0),s=(r>>>=0)-(t>>>=0),a=Math.min(i,s),u=this.slice(n,o),c=e.slice(t,r),f=0;f<a;++f)if(u[f]!==c[f]){i=u[f],s=c[f];break}return i<s?-1:s<i?1:0},Pn.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},Pn.prototype.indexOf=function(e,t,r){return Ln(this,e,t,r,!0)},Pn.prototype.lastIndexOf=function(e,t,r){return Ln(this,e,t,r,!1)},Pn.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var o=this.length-t;if((void 0===r||r>o)&&(r=o),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var i=!1;;)switch(n){case"hex":return Dn(this,e,t,r);case"utf8":case"utf-8":return qn(this,e,t,r);case"ascii":case"latin1":case"binary":return Nn(this,e,t,r);case"base64":return zn(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Hn(this,e,t,r);default:if(i)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),i=!0}},Pn.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Wn=4096;function Yn(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(127&e[o]);return n}function Vn(e,t,r){var n="";r=Math.min(e.length,r);for(var o=t;o<r;++o)n+=String.fromCharCode(e[o]);return n}function Gn(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var o="",i=t;i<r;++i)o+=co[e[i]];return o}function Zn(e,t,r){for(var n=e.slice(t,r),o="",i=0;i<n.length-1;i+=2)o+=String.fromCharCode(n[i]+256*n[i+1]);return o}function Qn(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function Xn(e,t,r,n,o,i){if(!Pn.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>o||t<i)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function eo(e,t,r,n,o,i){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function to(e,t,r,n,o){return t=+t,r>>>=0,o||eo(e,0,r,4),bn(e,t,r,n,23,4),r+4}function ro(e,t,r,n,o){return t=+t,r>>>=0,o||eo(e,0,r,8),bn(e,t,r,n,52,8),r+8}Pn.prototype.slice=function(e,t){var r=this.length;(e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n=this.subarray(e,t);return Object.setPrototypeOf(n,Pn.prototype),n},Pn.prototype.readUintLE=Pn.prototype.readUIntLE=function(e,t,r){e>>>=0,t>>>=0,r||Qn(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n},Pn.prototype.readUintBE=Pn.prototype.readUIntBE=function(e,t,r){e>>>=0,t>>>=0,r||Qn(e,t,this.length);for(var n=this[e+--t],o=1;t>0&&(o*=256);)n+=this[e+--t]*o;return n},Pn.prototype.readUint8=Pn.prototype.readUInt8=function(e,t){return e>>>=0,t||Qn(e,1,this.length),this[e]},Pn.prototype.readUint16LE=Pn.prototype.readUInt16LE=function(e,t){return e>>>=0,t||Qn(e,2,this.length),this[e]|this[e+1]<<8},Pn.prototype.readUint16BE=Pn.prototype.readUInt16BE=function(e,t){return e>>>=0,t||Qn(e,2,this.length),this[e]<<8|this[e+1]},Pn.prototype.readUint32LE=Pn.prototype.readUInt32LE=function(e,t){return e>>>=0,t||Qn(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},Pn.prototype.readUint32BE=Pn.prototype.readUInt32BE=function(e,t){return e>>>=0,t||Qn(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},Pn.prototype.readIntLE=function(e,t,r){e>>>=0,t>>>=0,r||Qn(e,t,this.length);for(var n=this[e],o=1,i=0;++i<t&&(o*=256);)n+=this[e+i]*o;return n>=(o*=128)&&(n-=Math.pow(2,8*t)),n},Pn.prototype.readIntBE=function(e,t,r){e>>>=0,t>>>=0,r||Qn(e,t,this.length);for(var n=t,o=1,i=this[e+--n];n>0&&(o*=256);)i+=this[e+--n]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*t)),i},Pn.prototype.readInt8=function(e,t){return e>>>=0,t||Qn(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},Pn.prototype.readInt16LE=function(e,t){e>>>=0,t||Qn(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},Pn.prototype.readInt16BE=function(e,t){e>>>=0,t||Qn(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},Pn.prototype.readInt32LE=function(e,t){return e>>>=0,t||Qn(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},Pn.prototype.readInt32BE=function(e,t){return e>>>=0,t||Qn(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},Pn.prototype.readFloatLE=function(e,t){return e>>>=0,t||Qn(e,4,this.length),gn(this,e,!0,23,4)},Pn.prototype.readFloatBE=function(e,t){return e>>>=0,t||Qn(e,4,this.length),gn(this,e,!1,23,4)},Pn.prototype.readDoubleLE=function(e,t){return e>>>=0,t||Qn(e,8,this.length),gn(this,e,!0,52,8)},Pn.prototype.readDoubleBE=function(e,t){return e>>>=0,t||Qn(e,8,this.length),gn(this,e,!1,52,8)},Pn.prototype.writeUintLE=Pn.prototype.writeUIntLE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||Xn(this,e,t,r,Math.pow(2,8*r)-1,0);var o=1,i=0;for(this[t]=255&e;++i<r&&(o*=256);)this[t+i]=e/o&255;return t+r},Pn.prototype.writeUintBE=Pn.prototype.writeUIntBE=function(e,t,r,n){e=+e,t>>>=0,r>>>=0,n||Xn(this,e,t,r,Math.pow(2,8*r)-1,0);var o=r-1,i=1;for(this[t+o]=255&e;--o>=0&&(i*=256);)this[t+o]=e/i&255;return t+r},Pn.prototype.writeUint8=Pn.prototype.writeUInt8=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,1,255,0),this[t]=255&e,t+1},Pn.prototype.writeUint16LE=Pn.prototype.writeUInt16LE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},Pn.prototype.writeUint16BE=Pn.prototype.writeUInt16BE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},Pn.prototype.writeUint32LE=Pn.prototype.writeUInt32LE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},Pn.prototype.writeUint32BE=Pn.prototype.writeUInt32BE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Pn.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);Xn(this,e,t,r,o-1,-o)}var i=0,s=1,a=0;for(this[t]=255&e;++i<r&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},Pn.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t>>>=0,!n){var o=Math.pow(2,8*r-1);Xn(this,e,t,r,o-1,-o)}var i=r-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+r},Pn.prototype.writeInt8=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},Pn.prototype.writeInt16LE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},Pn.prototype.writeInt16BE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},Pn.prototype.writeInt32LE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},Pn.prototype.writeInt32BE=function(e,t,r){return e=+e,t>>>=0,r||Xn(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},Pn.prototype.writeFloatLE=function(e,t,r){return to(this,e,t,!0,r)},Pn.prototype.writeFloatBE=function(e,t,r){return to(this,e,t,!1,r)},Pn.prototype.writeDoubleLE=function(e,t,r){return ro(this,e,t,!0,r)},Pn.prototype.writeDoubleBE=function(e,t,r){return ro(this,e,t,!1,r)},Pn.prototype.copy=function(e,t,r,n){if(!Pn.isBuffer(e))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var o=n-r;return this===e&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,r,n):Uint8Array.prototype.set.call(e,this.subarray(r,n),t),o},Pn.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Pn.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===e.length){var o=e.charCodeAt(0);("utf8"===n&&o<128||"latin1"===n)&&(e=o)}}else"number"==typeof e?e&=255:"boolean"==typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;var i;if(t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0),"number"==typeof e)for(i=t;i<r;++i)this[i]=e;else{var s=Pn.isBuffer(e)?e:Pn.from(e,n),a=s.length;if(0===a)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<r-t;++i)this[i+t]=s[i%a]}return this};var no=/[^+/0-9A-Za-z-_]/g;function oo(e,t){var r;t=t||1/0;for(var n=e.length,o=null,i=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!o){if(r>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&i.push(239,191,189);continue}o=r;continue}if(r<56320){(t-=3)>-1&&i.push(239,191,189),o=r;continue}r=65536+(o-55296<<10|r-56320)}else o&&(t-=3)>-1&&i.push(239,191,189);if(o=null,r<128){if((t-=1)<0)break;i.push(r)}else if(r<2048){if((t-=2)<0)break;i.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;i.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return i}function io(e){return sn(function(e){if((e=(e=e.split("=")[0]).trim().replace(no,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function so(e,t,r,n){for(var o=0;o<n&&!(o+r>=t.length||o>=e.length);++o)t[o+r]=e[o];return o}function ao(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function uo(e){return e!=e}var co=function(){for(var e="0123456789abcdef",t=new Array(256),r=0;r<16;++r)for(var n=16*r,o=0;o<16;++o)t[n+o]=e[r]+e[o];return t}(),fo=on;const lo="function"==typeof atob,ho="function"==typeof btoa,po="function"==typeof fo,yo="function"==typeof TextDecoder?new TextDecoder:void 0,go="function"==typeof TextEncoder?new TextEncoder:void 0,bo=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),mo=(e=>{let t={};return e.forEach(((e,r)=>t[e]=r)),t})(bo),wo=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,vo=String.fromCharCode.bind(String),Ao="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):(e,t=(e=>e))=>new Uint8Array(Array.prototype.slice.call(e,0).map(t)),Eo=e=>e.replace(/=/g,"").replace(/[+\/]/g,(e=>"+"==e?"-":"_")),Co=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),So=ho?e=>btoa(e):po?e=>fo.from(e,"binary").toString("base64"):e=>{let t,r,n,o,i="";const s=e.length%3;for(let s=0;s<e.length;){if((r=e.charCodeAt(s++))>255||(n=e.charCodeAt(s++))>255||(o=e.charCodeAt(s++))>255)throw new TypeError("invalid character found");t=r<<16|n<<8|o,i+=bo[t>>18&63]+bo[t>>12&63]+bo[t>>6&63]+bo[63&t]}return s?i.slice(0,s-3)+"===".substring(s):i},Oo=po?e=>fo.from(e).toString("base64"):e=>{let t=[];for(let r=0,n=e.length;r<n;r+=4096)t.push(vo.apply(null,e.subarray(r,r+4096)));return So(t.join(""))},ko=(e,t=!1)=>t?Eo(Oo(e)):Oo(e),_o=e=>{if(e.length<2)return(t=e.charCodeAt(0))<128?e:t<2048?vo(192|t>>>6)+vo(128|63&t):vo(224|t>>>12&15)+vo(128|t>>>6&63)+vo(128|63&t);var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return vo(240|t>>>18&7)+vo(128|t>>>12&63)+vo(128|t>>>6&63)+vo(128|63&t)},Po=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Ro=po?e=>fo.from(e,"utf8").toString("base64"):go?e=>Oo(go.encode(e)):e=>So((e=>e.replace(Po,_o))(e)),To=e=>((e,t=!1)=>t?Eo(Ro(e)):Ro(e))(e,!0),Uo=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,jo=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return vo(55296+(t>>>10))+vo(56320+(1023&t));case 3:return vo((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return vo((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},xo=lo?e=>atob(Co(e)):po?e=>fo.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!wo.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,r,n,o="";for(let i=0;i<e.length;)t=mo[e.charAt(i++)]<<18|mo[e.charAt(i++)]<<12|(r=mo[e.charAt(i++)])<<6|(n=mo[e.charAt(i++)]),o+=64===r?vo(t>>16&255):64===n?vo(t>>16&255,t>>8&255):vo(t>>16&255,t>>8&255,255&t);return o},Io=po?e=>Ao(fo.from(e,"base64")):e=>Ao(xo(e),(e=>e.charCodeAt(0))),Fo=po?e=>fo.from(e,"base64").toString("utf8"):yo?e=>yo.decode(Io(e)):e=>(e=>e.replace(Uo,jo))(xo(e)),Bo=e=>Fo((e=>Co(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))))(e)),Mo="object"==typeof globalThis&&globalThis.crypto?globalThis.crypto:i("e8CjI").default,Lo=Mo.subtle,Ko={ES384:{name:"ECDSA",namedCurve:"P-384"},RS384:{name:"RSASSA-PKCS1-v1_5",modulusLength:4096,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-384"}}};function Do(e){return Mo.getRandomValues(new Uint8Array(e))}async function qo(e){const t=(new TextEncoder).encode(e),r=await Lo.digest("SHA-256",t);return new Uint8Array(r)}se.randomBytes=Do,se.digestSha256=qo,se.generatePKCEChallenge=async(e=96)=>{const t=Do(e),r=ko(t,!0);return{codeChallenge:ko(await qo(r),!0),codeVerifier:r}},se.importJWK=async function(e){if(!e.alg)throw new Error('The "alg" property of the JWK must be set to "ES384" or "RS384"');if(Array.isArray(e.key_ops)||(e.key_ops=["sign"]),!e.key_ops.includes("sign"))throw new Error('The "key_ops" property of the JWK does not contain "sign"');try{return await Lo.importKey("jwk",e,Ko[e.alg],!0===e.ext,e.key_ops)}catch(t){throw new Error(`The ${e.alg} is not supported by this browser: ${t}`)}},se.signCompactJws=async function(e,t,r,n){const o=JSON.stringify(Object.assign(Object.assign({},r),{alg:e})),i=JSON.stringify(n),s=`${To(o)}.${To(i)}`,a=await Lo.sign(Object.assign(Object.assign({},t.algorithm),{hash:"SHA-384"}),t,(new TextEncoder).encode(s));return`${s}.${ko(new Uint8Array(a),!0)}`},s.default=class{constructor(e={}){this._url=null,this._storage=null,this.security=se,this.options=Object.assign({replaceBrowserHistory:!0,fullSessionStorageSupport:!0,refreshTokenWithCredentials:"same-origin"},e)}relative(e){return new URL(e,this.getUrl().href).href}get fhir(){return"function"==typeof fhir?fhir:null}getUrl(){return this._url||(this._url=new URL(location+"")),this._url}redirect(e){location.href=e}getStorage(){return this._storage||(this._storage=new ie.default),this._storage}getAbortController(){return AbortController}atob(e){return window.atob(e)}btoa(e){return window.btoa(e)}base64urlencode(e){return"string"==typeof e?To(e):ko(e,!0)}base64urldecode(e){return Bo(e)}getSmartApi(){return{ready:(...e)=>(0,a.ready)(this,...e),authorize:e=>(0,a.authorize)(this,e),init:e=>(0,a.init)(this,e),client:e=>new z.default(this,e),options:this.options,utils:{security:se}}}};const No=new s.default,{ready:zo,authorize:Ho,init:$o,client:Jo,options:Wo,utils:Yo}=No.getSmartApi();if("undefined"==typeof FHIRCLIENT_PURE){const e=i("16s93");i("jk3TS"),window.fetch||(window.fetch=e.default,window.Headers=e.Headers,window.Request=e.Request,window.Response=e.Response)}(function(e){return e&&e.__esModule?e.default:e})({AbortController:window.AbortController,client:Jo,utils:Yo,oauth2:{settings:Wo,ready:zo,authorize:Ho,init:$o}}).oauth2.authorize({clientId:"my_fhir_web_app",fhirServiceUrl:"https://r4.smarthealthit.org",redirectUri:"index.html",patientId:"a85b31e5-8f0c-480d-9e81-67408608dd7a"})})();
//# sourceMappingURL=launch.45d0a788.js.map
